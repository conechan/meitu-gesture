!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("gesture",e):t.gesture=e()}(this,function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o="function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?function(t){return void 0===t?"undefined":n(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":void 0===t?"undefined":n(t)},r={getLength:function(t){return"object"!==(void 0===t?"undefined":o(t))?void console.error("getLength error!"):Math.sqrt(t.x*t.x+t.y*t.y)},getAngle:function(t,e){if("object"!==(void 0===t?"undefined":o(t))||"object"!==(void 0===e?"undefined":o(e)))return void console.error("getAngle error!");var i=t.x*e.y-e.x*t.y>0?1:-1,n=this.getLength(t),r=this.getLength(e),s=n*r,a=void 0,h=void 0;return 0===s?0:(a=t.x*e.x+t.y*e.y,h=a/s,h>1&&(h=1),h<-1&&(h=-1),Math.acos(h)*i*180/Math.PI)},getBasePoint:function(t){if(!t)return void console.error("getBasePoint error!");var e=this.getOffset(t),i=e.left+t.getBoundingClientRect().width/2,n=e.top+t.getBoundingClientRect().width/2;return{x:Math.round(i),y:Math.round(n)}},setPos:function(t,e){var i=JSON.stringify(e),n="translate3d("+e.x+"px,"+e.y+"px,0px) scale("+e.scale+") rotate("+e.rotate+"deg)";t="string"==typeof t?document.querySelector(t):t,t.style.transform=n,t.setAttribute("data-mtouch-status",i)},getPos:function(t){var e=void 0,i=window.getComputedStyle(t,null).transform;return e=window.getComputedStyle&&"none"!==i?this.matrixTo(i):{x:0,y:0,scale:1,rotate:0},JSON.parse(t.getAttribute("data-mtouch-status"))||e},extend:function(t,e){for(var i in e)e.hasOwnProperty(i)&&("object"==o(e[i])?("object"!==o(t[i])&&(t[i]={}),this.extend(t[i],e[i])):t[i]=e[i]);return t},getVector:function(t,e){return"object"!==(void 0===t?"undefined":o(t))||"object"!==(void 0===e?"undefined":o(e))?void console.error("getvector error!"):{x:Math.round(t.x-e.x),y:Math.round(t.y-e.y)}},getPoint:function(t,e){return t&&t.touches[e]?{x:Math.round(t.touches[e].pageX),y:Math.round(t.touches[e].pageY)}:void console.error("getPoint error!")},getOffset:function(t){t="string"==typeof t?document.querySelector(t):t;var e=t.getBoundingClientRect();return{left:e.left+document.body.scrollLeft,top:e.top+document.body.scrollTop,width:t.offsetWidth,height:t.offsetHeight}},matrixTo:function(t){var e=t.replace("matrix(","").replace(")","").split(","),i=e[0],n=e[1],o=n/i,r=180*Math.atan(o)/Math.PI,s=i/Math.cos(Math.PI/180*r);return{x:parseInt(e[4]),y:parseInt(e[5]),scale:s,rotate:r}}},s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=function(){function e(i){t(this,e),this.handlers=[],this.el=i}return s(e,[{key:"add",value:function(t){return this.handlers.push(t),this}},{key:"del",value:function(t){var e=this;return t?this.handlers.forEach(function(i,n){i===t&&e.handlers.splice(n,1)}):this.handlers=[],this}},{key:"fire",value:function(){var t=this,e=arguments;if(this.handlers&&0!==!this.handlers.length)return this.handlers.forEach(function(i){"function"==typeof i&&i.apply(t.el,e)}),this}}]),e}(),h=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),c=["touchstart","touchmove","touchend","drag","dragstart","dragend","pinch","pinchstart","pinchend","rotate","rotatestart","rotatend"],u=function(){function t(i){if(e(this,t),this.ops={receiver:null,operator:null,touchstart:function(){},touchmove:function(){},touchend:function(){},drag:function(){},dragstart:function(){},dragend:function(){},pinch:function(){},pinchstart:function(){},pinchend:function(){},rotate:function(){},rotatestart:function(){},rotatend:function(){},singlePinch:{start:function(){},pinch:function(){},end:function(){},buttonId:null},singleRotate:{start:function(){},rotate:function(){},end:function(){},buttonId:null}},this.use={drag:!!i.drag||!!i.dragstart||!!i.dragend,pinch:!!i.pinch||!!i.pinchstart||!!i.pinchend,rotate:!!i.rotate||!!i.rotatestart||!!i.rotateend,singlePinch:!!i.singlePinch&&!!i.singlePinch.buttonId,singleRotate:!!i.singleRotate&&!!i.singleRotate.buttonId},this.ops=r.extend(this.ops,i),!this.ops.receiver||"string"!=typeof this.ops.receiver)return void console.error("receiver error,there must be a receiver-selector");if(this.receiver=document.querySelector(this.ops.receiver),this.ops.operator){if("string"!=typeof this.ops.operator)return void console.error("operator error, the operator param must be a selector");this.operator=document.querySelector(this.ops.operator)}else this.operator=this.receiver;this.fingers=0,this.draging=this.pinching=this.rotating=this.singleRotating=this.singlePinching=!1,this.startScale=1,this.startPoint={},this.secondPoint={},this.pinchStartLength=null,this.singlePinchStartLength=null,this.vector1={},this.singleBasePoint={},this.driveBus(),this.bind()}return h(t,[{key:"driveBus",value:function(){var t=this;c.forEach(function(e){t[e]=new a(t.receiver).add(t.ops[e]||function(){})}),this.singlePinchstart=new a(this.receiver).add(this.ops.singlePinch.start||function(){}),this.singlePinch=new a(this.receiver).add(this.ops.singlePinch.pinch||function(){}),this.singlePinchend=new a(this.receiver).add(this.ops.singlePinch.end||function(){}),this.singleRotatestart=new a(this.receiver).add(this.ops.singleRotate.start||function(){}),this.singleRotate=new a(this.receiver).add(this.ops.singleRotate.rotate||function(){}),this.singleRotatend=new a(this.receiver).add(this.ops.singleRotate.end||function(){})}},{key:"bind",value:function(){var t=this;["touchstart","touchmove","touchend","touchcancel"].forEach(function(e){var i="touchcancel"==e?"end":e.replace("touch","");t.receiver.addEventListener(e,t[i].bind(t),!1)})}},{key:"start",value:function(t){if(t.touches&&"touchstart"===t.type){if(this.fingers=t.touches.length,this.startPoint=r.getPoint(t,0),this.singleBasePoint=r.getBasePoint(this.operator),this.fingers>1)this.secondPoint=r.getPoint(t,1),this.vector1=r.getVector(this.secondPoint,this.startPoint),this.pinchStartLength=r.getLength(this.vector1);else if(this.use.singlePinch){var e=r.getVector(this.startPoint,this.singleBasePoint);this.singlePinchStartLength=r.getLength(e)}this.touchstart.fire({origin:t,eventType:"touchstart"})}}},{key:"move",value:function(t){if(t.touches&&"touchmove"===t.type){var e=r.getPoint(t,0),i=t.touches.length,n=void 0,o=void 0,s=void 0,a=void 0,h=void 0;if(i<this.fingers)return this.startPoint=e,void(this.fingers=i);if(!(i>1)||this.secondPoint&&this.vector1&&this.pinchStartLength||(this.secondPoint=r.getPoint(t,1),this.vector1=r.getVector(this.secondPoint,this.startPoint),this.pinchStartLength=r.getLength(this.vector1)),i>1){var c=r.getPoint(t,1),u=r.getVector(c,e);this.use.pinch&&(a=r.getLength(u),this.eventFire("pinch",{delta:{scale:a/this.pinchStartLength},origin:t}),this.pinchStartLength=a),this.use.rotate&&(this.eventFire("rotate",{delta:{rotate:r.getAngle(this.vector1,u)},origin:t}),this.vector1=u)}else this.use.singlePinch&&t.target.id==this.ops.singlePinch.buttonId&&(s=r.getVector(e,this.singleBasePoint),h=r.getLength(s),this.eventFire("singlePinch",{delta:{scale:h/this.singlePinchStartLength},origin:t}),this.singlePinchStartLength=h),this.use.singleRotate&&t.target.id==this.ops.singleRotate.buttonId&&(n=r.getVector(this.startPoint,this.singleBasePoint),o=r.getVector(e,this.singleBasePoint),this.eventFire("singleRotate",{delta:{rotate:r.getAngle(n,o)},origin:t}));this.use.drag&&t.target.id!==this.ops.singlePinch.buttonId&&t.target.id!==this.ops.singleRotate.buttonId&&this.eventFire("drag",{delta:{deltaX:e.x-this.startPoint.x,deltaY:e.y-this.startPoint.y},origin:t}),this.startPoint=e,this.touchmove.fire({eventType:"touchmove",origin:t}),t.preventDefault()}}},{key:"end",value:function(t){var e=this;(t.touches||"touchend"===t.type||"touchcancel"===t.type)&&(["pinch","drag","rotate","singleRotate","singlePinch"].forEach(function(i){e.eventEnd(i,{origin:t})}),this.touchend.fire({eventType:"touchend",origin:t}))}},{key:"eventFire",value:function(t,e){var i=t+"ing",n=t+"start";this[i]?(e.eventType=t,this[t].fire(e)):(e.eventType=n,this[n].fire(e),this[i]=!0)}},{key:"eventEnd",value:function(t,e){var i=t+"ing",n=void 0;n="rotate"==t||"singleRotate"==t?t+"nd":t+"end",this[i]&&(e.eventType=n,this[n].fire(e),this[i]=!1)}},{key:"switchOperator",value:function(t){this.operator=t}},{key:"on",value:function(t,e){this[t]&&this[t].add(e)}},{key:"off",value:function(t,e){this[t]&&this[t].del(e)}}]),t}(),l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d={getLength:function(t){return t?Math.sqrt(t.x*t.x+t.y*t.y):void console.error("getLength error!")},getAngle:function(t,e){if(!t||!e)return void console.error("getAngle error!");var i=t.x*e.y-e.x*t.y;i=i>0?1:-1;var n=Math.sqrt(t.x*t.x+t.y*t.y),o=Math.sqrt(e.x*e.x+e.y*e.y),r=n*o;if(0===r)return 0;var s=t.x*e.x+t.y*e.y,a=s/r;return a>1&&(a=1),a<-1&&(a=-1),Math.acos(a)*i*180/Math.PI},getBasePoint:function(t){if(!t)return void console.error("getBasePoint error!");var e=t.getBoundingClientRect().left+t.getBoundingClientRect().width/2,i=t.getBoundingClientRect().top+t.getBoundingClientRect().width/2;return{x:Math.round(e),y:Math.round(i)}},setPos:function(t,e){var i=JSON.stringify(e),n="translate3d("+e.x+"px,"+e.y+"px,0px) scale("+e.scale+") rotate("+e.rotate+"deg)";t="string"==typeof t?document.querySelector(t):t,t.style.transform=n,t.setAttribute("data-mtouch-status",i)},getPos:function(t){var e=void 0,i=window.getComputedStyle(t,null).transform;return e=window.getComputedStyle&&"none"!==i?this.matrixTo(i):{x:0,y:0,scale:1,rotate:0},JSON.parse(t.getAttribute("data-mtouch-status"))||e},extend:function(t,e){for(var i in e)e.hasOwnProperty(i)&&("object"==l(e[i])?("object"===l(t[i])&&null!==t[i]||(t[i]={}),this.extend(t[i],e[i])):t[i]=e[i]);return t},getVector:function(t,e){return t&&e?{x:Math.round(t.x-e.x),y:Math.round(t.y-e.y)}:void console.error("getvector error!")},getPoint:function(t,e){return t&&t.touches[e]?{x:Math.round(t.touches[e].pageX),y:Math.round(t.touches[e].pageY)}:void console.error("getPoint error!")},getOffset:function(t){t="string"==typeof t?document.querySelector(t):t;var e={};return e.width=t.offsetWidth,e.height=t.offsetHeight,e},matrixTo:function(t){var e=t.replace("matrix(","").replace(")","").split(","),i=e[0],n=e[1],o=n/i,r=180*Math.atan(o)/Math.PI,s=i/Math.cos(Math.PI/180*r);return{x:parseInt(e[4]),y:parseInt(e[5]),scale:s,rotate:r}}},f=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();return window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),function(){function t(e){if(i(this,t),this.freezed=!1,this.ops={receiver:null,operator:null,drag:!1,pinch:!1,rotate:!1,singlePinch:!1,singleRotate:!1,limit:null,event:{touchstart:function(){},touchmove:function(){},touchend:function(){},dragstart:function(){},drag:function(){},dragend:function(){},pinchstart:function(){},pinch:function(){},pinchend:function(){},rotatestart:function(){},rotate:function(){},rotatend:function(){},singlePinchstart:function(){},singlePinch:function(){},singlePinchend:function(){},singleRotatestart:function(){},singleRotate:function(){},singleRotatend:function(){}}},!e.receiver||"string"!=typeof e.receiver)return void console.error("receiver error,there must be a receiver-selector");if(e.operator&&"string"!=typeof e.operator)return void console.error("operator error, the operator param must be a selector");if(this.ops=d.extend(this.ops,e),this.receiver=document.querySelector(this.ops.receiver),this.receiverStatus=this.receiver.getBoundingClientRect(),this.ops.operator?this.operator=document.querySelector(this.ops.operator):this.operator=this.receiver,this.operatorStatus=this.operator.getBoundingClientRect(),"crop"===e.limit){var n=0,o=0;this.operatorStatus.width>this.receiverStatus.width&&(n=(this.operatorStatus.width-this.receiverStatus.width)/this.operatorStatus.width),this.operatorStatus.height>this.receiverStatus.height&&(o=(this.operatorStatus.height-this.receiverStatus.height)/this.operatorStatus.height),this.ops.limit={x:n,y:o,maxScale:1,minScale:1}}else!0===e.limit&&(this.ops.limit={x:.5,y:.5,maxScale:3,minScale:.4});this.transform=d.getPos(this.operator),this.mtouch=new u({receiver:this.ops.receiver,operator:this.ops.operator,touchstart:this.touchstart.bind(this),touchmove:this.ops.event.touchmove,touchend:this.ops.event.touchend,drag:this.drag.bind(this),dragstart:this.ops.event.dragstart,dragend:this.ops.event.dragend,pinch:this.pinch.bind(this),pinchstart:this.ops.event.pinchstart,pinchend:this.ops.event.pinchend,rotate:this.rotate.bind(this),rotatestart:this.ops.event.rotatestart,rotatend:this.ops.event.rotatend,singlePinch:{start:this.ops.event.singlePinchstart,pinch:this.singlePinch.bind(this),end:this.ops.event.singlePinchend,buttonId:this.ops.singlePinch.buttonId},singleRotate:{start:this.ops.event.singleRotatestart,rotate:this.singleRotate.bind(this),end:this.ops.event.singleRotatend,buttonId:this.ops.singleRotate.buttonId}})}return f(t,[{key:"touchstart",value:function(t){this.transform=d.getPos(this.operator),this.ops.event.touchstart(t)}},{key:"drag",value:function(t){this.ops.drag&&!this.freezed&&(this.transform.x+=t.delta.deltaX,this.transform.y+=t.delta.deltaY,this.setTransform(),this.ops.event.drag(t))}},{key:"pinch",value:function(t){this.ops.pinch&&!this.freezed&&(this.transform.scale*=t.delta.scale,this.setTransform(),this.ops.event.pinch(t))}},{key:"rotate",value:function(t){this.ops.rotate&&!this.freezed&&(this.transform.rotate+=t.delta.rotate,this.setTransform(),this.ops.event.rotate(t))}},{key:"singlePinch",value:function(t){this.ops.singlePinch&&!this.freezed&&(this.transform.scale*=t.delta.scale,this.setTransform(),this.ops.event.singlePinch(t))}},{key:"singleRotate",value:function(t){this.ops.singleRotate&&!this.freezed&&(this.transform.rotate+=t.delta.rotate,this.setTransform(),this.ops.event.singleRotate(t))}},{key:"setTransform",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.operator,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.transform,i=JSON.parse(JSON.stringify(e));this.ops.limit&&(i=this.limitOperator(i)),window.requestAnimFrame(function(){d.setPos(t,i)})}},{key:"limitOperator",value:function(t){var e=this.ops.limit,i=e.minScale,n=e.maxScale;this.ops.limit.minScale&&t.scale<i&&(t.scale=i),this.ops.limit.maxScale&&t.scale>n&&(t.scale=n);var o=d.getOffset(this.operator),r=o.width*(t.scale-1)/2,s=o.height*(t.scale-1)/2,a=o.width*t.scale*this.ops.limit.x,h=o.height*t.scale*this.ops.limit.y,c=r-a,u=r-h,l=this.receiverStatus.width-o.width*t.scale+r+a,f=this.receiverStatus.height-o.height*t.scale+s+h;return(this.ops.limit.x||0==this.ops.limit.x)&&(t.x>=l&&(t.x=l),t.x<c&&(t.x=c)),(this.ops.limit.y||0==this.ops.limit.y)&&(t.y>f&&(t.y=f),t.y<u&&(t.y=u)),t}},{key:"switchOperator",value:function(t){return t="string"==typeof t?document.querySelector(t):t,this.mtouch.switchOperator(t),this.operator=t,this.freeze(!1),this}},{key:"freeze",value:function(t){return this.freezed=!!t,this}}]),t}()});
//# sourceMappingURL=gesture.min.js.map
